<!DOCTYPE html>
<html lang="en">
  <head>

    <!-- Meta tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Eleventy v3.1.1">

    <!-- SEO -->
    <title>
      
        Responsive images on a static Hugo website - Mijndert Stuij
      
    </title>
    
    <meta name="description" content="Serving optimized responsive images using Hugo">
    <meta property="og:description" content="Serving optimized responsive images using Hugo">
    
    <link rel="canonical" href="https://mijndertstuij.nl/posts/hugo-responsive-images/">
    <meta name="robots" content="index, follow">

    <!-- Open Graph -->
    <meta name="fediverse:creator" content="@mijndert@toot.community">
    <meta property="og:title" content="Responsive images on a static Hugo website">
    <meta property="og:site_name" content="Mijndert Stuij">
    <meta property="og:url" content="https://mijndertstuij.nl/posts/hugo-responsive-images/">
    <meta property="og:type" content="article">

    <!-- Theme color -->
    <meta name="theme-color" content="#eee9dc" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#1a1b1e" media="(prefers-color-scheme: dark)">

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">

    <!-- RSS feeds -->
    <link rel="alternate" type="application/rss+xml" href="https://mijndertstuij.nl/feed.xml">
    <link rel="alternate" type="application/rss+xml" href="https://mijndertstuij.nl/weeknotes-feed.xml">
    <link rel="alternate" type="application/rss+xml" href="https://mijndertstuij.nl/posts-feed.xml">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Font -->
     <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
  </head>
  
  <body>
    <nav aria-label="Main navigation">
  <ul class="nav">
    
    <li>
      <a href="/" class="nav-link">Mijndert Stuij</a>
    </li>
    
    <li>
      <a href="/blog/" class="nav-link">Blog</a>
    </li>
    
    <li>
      <a href="/weeknotes/" class="nav-link">Week notes</a>
    </li>
    
    <li>
      <a href="/explore/" class="nav-link">Explore</a>
    </li>
    
  </ul>
</nav>

    
    

    <main>
      
<h1>Responsive images on a static Hugo website</h1>
<span class="meta">
  <p class="muted">
    Dec 6, 2022
  </p>
</span>
<p>For years and years I've been using <a href="https://jekyllrb.com/">Jekyll</a> as my static site generator of choice, mostly because I like their templating engine and I'm a fan of Ruby as a programming language. I've been experimenting with Hugo as well, but it never really clicked for me. Well, until I found <a href="https://github.com/mavidser/hugo-rocinante">the perfect theme</a> for my needs. The same theme is now used here and on the <a href="https://blog.toot.community/">toot.community blog</a> so I wanted to set mine apart a little bit by adding banner images on some posts. Downloading an image from Unsplash and manually resizing it wasn't an option though - I need things to be frictionless when I want to add a blog entry.</p>
<p>I started looking for ways to automatically generate multiple sizes of an image and came across a lot of different solutions. Most didn't work anymore or were very convoluted. That's to say, until I found <a href="https://www.brycewray.com/posts/2022/06/responsive-optimized-images-hugo/">Bryce Wray's entry</a>.</p>
<p>I quickly adapted his code to my needs and had it working on no-time, you can see it in action <a href="/posts/scaling-mastodon-community/">right here</a>.</p>
<p>Here's how I did it.</p>
<h2>Assets directory</h2>
<p>In order to leverage the built-in image resizing capabilities of Hugo, you have to create an <code>assets/images</code> directory in the root of your project. Any other place doesn't work, unless of course you customize the directory. But I like using defaults to avoid breakage later down the line.</p>
<h2>Shortcodes</h2>
<p>The following Hugo shortcode will generate multiple sizes of a given image and spit out .webp and .jpeg files.</p>
<p>Create a file called <code>/layouts/shortcodes/imgh.html</code> in the root of your project with the following contents.</p>
<pre class="language-html"><code class="language-html">{{- $respSizes := slice "960" "1280" "1920" -}}
{{- $imgBase := "images/" -}}
{{- $src := resources.Get (printf "%s%s" $imgBase (.Get "src")) -}}
{{- $alt := .Get "alt" -}}
{{- $divClass := "" -}}{{/* Init'g */}}
{{- $imgClass := "w-full h-auto animate-fade" -}}
{{- $dataSzes := "(min-width: 1024px) 100vw, 50vw" -}}
{{- $actualImg := $src.Resize "640x jpg" -}}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>picture</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span>
    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image/webp<span class="token punctuation">"</span></span>
    <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>
      {{- with $respSizes -}}
        {{- range $i, $e := . -}}
        {{- if ge $src.Width . -}}
          {{- if $i }}, {{ end -}}{{- ($src.Resize (printf <span class="token punctuation">"</span></span><span class="token attr-name">%sx%s"</span> <span class="token attr-name">.</span> <span class="token attr-name">"</span> <span class="token attr-name">webp")</span> <span class="token attr-name">).RelPermalink</span> <span class="token attr-name">}}</span> <span class="token attr-name">{{</span> <span class="token attr-name">.</span> <span class="token attr-name">}}w</span>
        <span class="token attr-name">{{-</span> <span class="token attr-name">end</span> <span class="token attr-name">-}}</span>
      <span class="token attr-name">{{-</span> <span class="token attr-name">end</span> <span class="token attr-name">-}}</span>
    <span class="token attr-name">{{-</span> <span class="token attr-name">end</span> <span class="token attr-name">-}}"</span>
    <span class="token attr-name">sizes</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ $dataSzes }}<span class="token punctuation">"</span></span>
  <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span>
    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image/jpeg<span class="token punctuation">"</span></span>
    <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>
      {{- with $respSizes -}}
        {{- range $i, $e := . -}}
          {{- if ge $src.Width . -}}
            {{- if $i }}, {{ end -}}{{- ($src.Resize (printf <span class="token punctuation">"</span></span><span class="token attr-name">%sx%s"</span> <span class="token attr-name">.</span> <span class="token attr-name">"</span> <span class="token attr-name">jpg")</span> <span class="token attr-name">).RelPermalink</span> <span class="token attr-name">}}</span> <span class="token attr-name">{{</span> <span class="token attr-name">.</span> <span class="token attr-name">}}w</span>
          <span class="token attr-name">{{-</span> <span class="token attr-name">end</span> <span class="token attr-name">-}}</span>
      <span class="token attr-name">{{-</span> <span class="token attr-name">end</span> <span class="token attr-name">-}}</span>
    <span class="token attr-name">{{-</span> <span class="token attr-name">end</span> <span class="token attr-name">-}}"\</span>
    <span class="token attr-name">sizes</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ $dataSzes }}<span class="token punctuation">"</span></span>
  <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ $imgClass }}<span class="token punctuation">"</span></span>
    <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ $actualImg.RelPermalink }}<span class="token punctuation">"</span></span>
    <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ $src.Width }}<span class="token punctuation">"</span></span>
    <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ $src.Height }}<span class="token punctuation">"</span></span>
    <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ $alt }}<span class="token punctuation">"</span></span>
    <span class="token attr-name">loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lazy<span class="token punctuation">"</span></span>
  <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>picture</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<h2>Using the shortcode</h2>
<p>Now in order to use the above shortcode you can simply drop an image into <code>/assets/images</code> and insert this line of code in your MarkDown file.</p>
<pre><code>{{&lt;/* imgh src=&quot;my-example-file.jpeg&quot; alt=&quot;My example file&quot; */&gt;}}
</code></pre>


    </main>

    <footer aria-label="Site footer">
  <p>Follow me via <a href="/feeds">RSS</a>, 
    <a rel="me" href="https://toot.community/@mijndert" aria-label="Follow me on Mastodon">Mastodon</a>, 
    or <a href="/connect" aria-label="Other connection options">other options</a>.</p>
</footer>
  </body>
</html>
