<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Eleventy v3.0.0">
    <meta name="fediverse:creator" content="@mijndert@fosstodon.org">
    <title>Scaling a Mastodon community to 27k people</title>
    <meta name="description" content="Scaling a Mastodon community to 27k people using Kubernetes and Digitalocean.">
    <link rel="canonical" href="https://mijndertstuij.nl/posts/scaling-mastodon-community/">
    <meta name="robots" content="index, follow">
    <link rel="alternate" type="application/rss+xml" href="https://mijndertstuij.nl/feed.xml">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">
    <link rel="stylesheet" href="/css/base.css">
    <link href="//prismjs.catppuccin.com/mocha.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
  </head>
  <body>
    <header>
  <a href="/">
    <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="32.000000pt" height="32.000000pt" viewBox="0 0 48.000000 48.000000" preserveAspectRatio="xMidYMid meet">
      <g transform="translate(0.000000,48.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">
        <path d="M404 459 c-10 -12 -34 -28 -52 -36 -40 -17 -50 -39 -29 -61 19 -19 35 -9 19 11 -7 8 -9 17 -5 20 13 14 23 6 23 -16 0 -29 43 -72 64 -64 9 4 16 17 16 30 0 14 6 40 14 58 15 37 6 79 -17 79 -8 0 -22 -10 -33 -21z m36 -23 c0 -28 -13 -47 -41 -62 -27 -14 -29 -13 -29 6 0 20 44 70 61 70 5 0 9 -6 9 -14z m-20 -86 c0 -5 -7 -10 -16 -10 -8 0 -12 5 -9 10 3 6 10 10 16 10 5 0 9 -4 9 -10z"></path>
        <path d="M156 445 c-112 -40 -171 -186 -115 -285 20 -35 20 -39 5 -68 -20 -39 -21 -81 -1 -88 31 -12 70 9 134 71 62 60 180 229 168 241 -3 3 -28 -27 -55 -68 -84 -124 -188 -228 -229 -228 -16 0 -17 40 -2 74 11 23 13 24 35 9 32 -20 31 -6 -1 19 -80 63 -71 197 18 275 40 35 88 48 145 39 l37 -5 -30 14 c-38 18 -60 18 -109 0z"></path>
        <path d="M416 240 c-18 -96 -64 -152 -148 -181 l-53 -18 38 -1 c96 0 186 107 175 210 l-3 35 -9 -45z"></path>
      </g>
    </svg>
  </a>
</header>
    <main>
      
<h1>Scaling a Mastodon community to 27k people</h1>
<p class="muted">Dec 4, 2022</p>
<article><p>Tomorrow marks the first full month of my move to <a href="https://toot.community/">toot.community</a>, a Mastodon instance initially set up by my friend <a href="https://jorijn.com/">Jorijn</a>. My move to Mastodon wasn't motivated by what's going at Twitter right now, but rather the technical challenges of scaling the shit out of it. In the first week we welcomed thousands of people and we certainly had to put out a fire or two, but most of the time we had the time to focus on optimization.</p>
<p>If you look at the <code>#MastoAdmin</code> hashtag on Mastodon you'll see a lot of messages from other admins sharing scaling tips and tricks. There I got the idea to <a href="https://blog.toot.community/posts/open-sourcing-toot-community/">open source everything</a> we were doing so that others could hopefully benefit from it. Open source software has shaped my carreer and giving back is the least I could do. While we were working on making the scaling of toot.community fully event-driven, I got to work to write <a href="https://github.com/toot-community/platform">Terraform code for the infrastructure</a>. Since I have a lot of experience with Terraform, I made sure to create modules for every part of the platform so we can easily rip out and replace every part of it without any hassle at all.</p>
<p>At the same time we were also working on a <a href="https://github.com/toot-community/kubernetes">fully event-driven scaling setup</a> on top of Kubernetes. Currently we run between 3 and 7 nodes in the Kubernetes cluster depending on the requests to the web server and the amount of messages in the queues. This way we're never overspending on infrastructure, something that's incredibly important while running a Mastodon community because it's fully supported by donations. Of course we don't want to squander the money so we're constantly optimizing and tweaking to be able to handle more people on the same amount of infrastructure; now at 27k people we're paying about the same amount of money per month as we were at 15k people.</p>
<p>We now have an event-driven, self-healing Mastodon instance that can basically scale into infinity given enough funds. That doesn't mean we sit back and relax however, we still have a ton of ideas to optimize further. Some things we want to do over the coming months include: getting our CloudFlare setup into Terraform, turning the screws on security, more visibility into key metrics, and database optimizations.</p>
<p>On the <a href="https://blog.toot.community">toot.community blog</a> we will publish updates on financials and some deepdives into the technical implementation of it all. There's an RSS feed it you want to follow along.</p>
</article>

    </main>
    <footer>
  <h2>Connect</h2>
  <p class="compact">Follow me via <a href="/feed.xml">RSS</a> or <a href="/connect">other options</a>.</p>
</footer>
  </body>
</html>
